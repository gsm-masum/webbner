<IfModule mod_mime.c>
    # Set the MIME type for Brotli and Gzip compressed files
    AddEncoding gzip .gz
    AddEncoding br .br

    # Set MIME types for specific file types
    AddType application/javascript .js
    AddType application/javascript .js.gz .js.br
    AddType application/octet-stream .data
    AddType application/octet-stream .data.gz .data.br
    AddType application/wasm .wasm
    AddType application/wasm .wasm.gz .wasm.br
</IfModule>

<IfModule mod_headers.c>
    # Serve Brotli files with Content-Encoding: br
    <FilesMatch "\.(js\.br|data\.br|wasm\.br)$">
        Header set Content-Encoding br
        Header set Cache-Control "public, max-age=31536000"
        Header unset ETag
        Header set Vary "Accept-Encoding"
    </FilesMatch>

    # Serve Gzip files with Content-Encoding: gzip
    <FilesMatch "\.(js\.gz|data\.gz|wasm\.gz)$">
        Header set Content-Encoding gzip
        Header set Cache-Control "public, max-age=31536000"
        Header unset ETag
        Header set Vary "Accept-Encoding"
    </FilesMatch>
</IfModule>

# Optional: Remove .gz or .br extension in URLs (for clean URLs)
RewriteEngine On
RewriteCond %{HTTP:Accept-Encoding} br
RewriteCond %{REQUEST_FILENAME}.br -f
RewriteRule ^(.*)\.(js|data|wasm)$ $1\.$2\.br [L]

RewriteCond %{HTTP:Accept-Encoding} gzip
RewriteCond %{REQUEST_FILENAME}.gz -f
RewriteRule ^(.*)\.(js|data|wasm)$ $1\.$2\.gz [L]
