<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WEBBner | Nasa Space Apps Challenge</title>
  <meta name="description" content="WEBBner | Nasa Space Apps Challenge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="author" content="WEBBner | Nasa Space Apps Challenge">
  <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">

  <!-- ========================= CSS here ========================= -->
  <link rel="stylesheet" href="assets/css/bootstrap-4.5.0.min.css">
  <link rel="stylesheet" href="assets/css/lineicons.css">
  <link rel="stylesheet" href="assets/css/animate.css">
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    /* Fullscreen canvas to replace the loader after loading */
    canvas {
      display: none;
      /* Hide initially until WebGL content is loaded */
      width: 100vw;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      /* Ensure it stays above all other content */
    }

    .main-06 {
      height: 100vh;
      /* Set the height to 100% of the viewport height */
      display: flex;
      /* Optional: Use flexbox to align children */
      flex-direction: column;
      /* Ensure the content inside is stacked vertically */
      justify-content: center;
      /* Center content vertically (optional) */
      align-items: center;
      /* Center content horizontally (optional) */
    }
  </style>
</head>

<body>
  <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

  <!-- ========================= main start ========================= -->
  <main class="main-06">
    <!-- header start  -->
    <div class="header header-06">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-4">
            <a href="#" class="logo"> <img src="assets/img/logo.png" alt=""></a>
          </div>
          <div class="col-md-8">
            <div class="header-right text-right">
              <a href="#">Please wait while we load WEBBner</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- header end  -->

    <!-- ========================= main-wrapper start ========================= -->
    <div class="main-wrapper demo-06">
      <!-- hero-area start  -->
      <div class="hero-area">
        <div class="container">
          <div class="row">
            <div class="col-xl-12">
              <!-- heading start  -->
              <div class="heading">
                <h1 class="text-white wow fadeInUp" data-wow-delay=".2s">WEBBner is Loading ... </h1>
              </div>
              <!-- heading end  -->
            </div>
            <div class="col-xl-7 col-lg-7">
              <!-- loader start -->
              <div class="wow fadeInRight" data-wow-delay=".4s">
                <!-- Progress Bar -->
                <div id="progress-bar" class="progress">
                  <div id="progress-bar-full" class="progress-bar" role="progressbar" style="width: 0%; background-color: #743af7;"
                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                  </div>
                </div>
                <!-- Progress Percentage Text -->
                <div id="loading-text" class="text-white mt-2">
                  <p class="text-center">0.00%</p>
                </div>
                <div id="bandwidth-text" class="text-white mt-2">
                  <p class="text-center">At Speed: 0 KB/s</p>
                </div>
              </div>
              <!-- loader end -->
            </div>
            <div class="col-xl-5 col-lg-5">
              <!-- desc start  -->
              <p class="wow fadeInLeft" data-wow-delay=".4s">
                Introducing WEBBner! <i>Explore the Universe through Webbâ€™s Eyes.</i> Our interactive 3D
                gallery brings the James Webb Telescope's discoveries and journeys to life!
              </p>
              <!-- desc end  -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Fullscreen canvas for Unity WebGL content -->
  <canvas id="unity-canvas" tabindex="-1"></canvas>

  <!-- ========================= JS here ========================= -->
  <script src="assets/js/vendor/modernizr-3.5.0.min.js"></script>
  <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
  <script src="assets/js/popper.min.js"></script>
  <script src="assets/js/bootstrap-4.5.0.min.js"></script>
  <script src="assets/js/wow.min.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    // Variables for loading
    var canvas = document.querySelector("#unity-canvas");
    var progressBarFull = document.querySelector("#progress-bar-full");
    var loadingText = document.querySelector("#loading-text p");
    var bandwidthText = document.querySelector("#bandwidth-text p");

    // Function to make canvas fullscreen
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Automatically fetch the hashed filenames (set correct filenames from your build)
    var buildUrl = "Build";
    var loaderUrl = buildUrl + "/webbner.loader.js"; // Replace with actual hashed loader.js
    var config = {
      dataUrl: buildUrl + "/webbner.data.gz", // Replace with actual hashed data file
      frameworkUrl: buildUrl + "/webbner.framework.js.gz", // Replace with actual hashed framework file
      codeUrl: buildUrl + "/webbner.wasm.gz", // Replace with actual hashed wasm file
    };

    var startTime = Date.now();
    var script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        // Total file size in MB (adjust according to your actual total build size)
        var totalBuildSizeMB = 75;
        progress = progress * 3.58;
        // Update progress bar and text with percentage
        let percentage = (progress * 100).toFixed(2); // 'progress' ranges from 0 to 1, so multiply by 100
        progressBarFull.style.width = `${percentage}%`;
        loadingText.innerHTML = `${percentage}%`;

        // Calculate and show bandwidth (KB/s)
        var elapsedTime = (Date.now() - startTime) / 1000; // Time in seconds
        var totalSizeLoadedMB = (progress * totalBuildSizeMB).toFixed(2); // Multiply progress by total size in MB
        var bandwidthKBps = ((totalSizeLoadedMB * 1024) / elapsedTime).toFixed(2); // Convert to KB/s (1MB = 1024KB)
        bandwidthText.innerHTML = `At Speed: ${bandwidthKBps} Kbps`;


      }).then((unityInstance) => {
        // Hide loader and show the canvas when done
        document.querySelector('.main-06').style.display = "none"; // Hide loader
        canvas.style.display = "block"; // Show the Unity canvas
      }).catch((message) => {
        alert(message);
      });
    };
    document.body.appendChild(script);
  </script>

</body>

</html>